<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>–ú–æ–π –≥–∞—Ä–¥–µ—Ä–æ–± ‚Äî –í–µ–±</title>
  <meta name="description" content="–ì–∞—Ä–¥–µ—Ä–æ–± ‚Äî –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞, –ø–ª–∞–Ω—à–µ—Ç–∞ –∏ —Ç–µ–ª–µ—Ñ–æ–ΩÔøΩÔøΩ" />
  <style>
    :root{
      --bg-0:#06101a; --bg-1:#0b1220; --panel:#0f1720; --muted:#9CA3AF;
      --accent:#dc2626; --accent-2:#06b6d4; --card-border:rgba(255,255,255,0.04);
      --radius:12px; --gap:16px; --max-width:1200px; --safe-top:env(safe-area-inset-top,0px);
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-0),var(--bg-1));color:#e6eef6;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto; -webkit-font-smoothing:antialiased}
    .wrap{max-width:var(--max-width);margin:calc(20px + var(--safe-top)) auto 40px;padding:16px}
    header{display:flex;align-items:flex-start;gap:16px;margin-bottom:18px}
    h1{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}

    .tabs{display:flex;gap:10px;margin-top:8px;flex-wrap:wrap}
    .tab{padding:10px 14px;border-radius:10px;background:transparent;border:1px solid transparent;color:var(--muted);cursor:pointer;font-size:14px}
    .tab.active{background:rgba(255,255,255,0.03);color:#fff;border-color:var(--card-border)}

    .main-grid{display:grid;grid-template-columns:1fr 320px;gap:var(--gap);align-items:start}
    .panel{background:var(--panel);border-radius:var(--radius);padding:16px;border:1px solid var(--card-border);box-shadow:0 6px 24px rgba(0,0,0,0.35)}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}

    input[type="text"], textarea, select{width:100%;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(0,0,0,0.35);color:#fff;font-size:14px}
    textarea{min-height:60px;resize:vertical}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}

    .controls{display:flex;gap:8px;align-items:center}
    .view-toggle{display:flex;gap:8px;align-items:center;margin-left:8px}
    .view-btn{padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer;color:var(--muted)}
    .view-btn.active{background:rgba(255,255,255,0.03);color:#fff;border-color:var(--card-border)}

    /* list view */
    .items-list{display:flex;flex-direction:column;gap:12px;margin-top:12px}
    .item{display:flex;gap:12px;align-items:flex-start;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
    .item-photo{width:72px;height:72px;border-radius:8px;flex-shrink:0;object-fit:cover;background:#071018;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:28px}

    /* grid view */
    .grid-view .items-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:12px}
    .grid-card{background:var(--panel);border-radius:12px;overflow:hidden;border:1px solid var(--card-border);transition:transform .18s ease,box-shadow .18s ease}
    .grid-card:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(0,0,0,0.5)}
    .card-photo{width:100%;height:180px;object-fit:cover;background:#071018;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:36px}
    .card-body{padding:12px}
    .grid-title{font-weight:700;margin-bottom:8px}
    .grid-meta{display:flex;justify-content:space-between;align-items:center;font-size:13px;color:var(--muted)}

    .badge{display:inline-block;padding:6px 8px;border-radius:999px;font-size:12px}
    .badge.green{background:#064e3b;color:#bbf7d0}
    .badge.red{background:#7f1d1d;color:#ffd7d7}
    .muted{color:var(--muted);font-size:13px}
    .kpi{font-size:20px;font-weight:700}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:1000}
    .modal{background:var(--panel);border-radius:10px;padding:16px;max-width:720px;width:96%;box-shadow:0 12px 40px rgba(0,0,0,0.6);border:1px solid var(--card-border)}
    .photo-preview{position:relative;display:inline-block}
    .del-photo{position:absolute;right:6px;top:6px;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.06);color:#fff;border-radius:999px;padding:4px 6px;cursor:pointer}

    /* responsive */
    @media (max-width:1000px){ .main-grid{grid-template-columns:1fr 300px} .grid-view .items-grid{grid-template-columns:repeat(3,1fr)} }
    @media (max-width:700px){ .grid-view .items-grid{grid-template-columns:repeat(2,1fr)} .item-photo{width:56px;height:56px} .card-photo{height:140px} }
    @media (max-width:480px){ .main-grid{grid-template-columns:1fr} .sidebar{order:2} .grid-view .items-grid{grid-template-columns:repeat(2,1fr)} .card-photo{height:120px} }

    :focus{outline:2px solid rgba(6,182,212,0.18);outline-offset:2px}
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <header>
      <div style="flex:1">
        <h1>–ú–æ–π –≥–∞—Ä–¥–µ—Ä–æ–± ‚Äî Web</h1>
        <div class="subtitle">–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –§–æ—Ç–æ –≤ base64 —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage.</div>

        <div class="tabs" role="tablist" aria-label="–†–∞–∑–¥–µ–ª—ã" style="margin-top:12px">
          <button class="tab active" data-tab="wardrobe">–ì–∞—Ä–¥–µ—Ä–æ–±</button>
          <button class="tab" data-tab="shopping">–®–æ–ø–∏–Ω–≥</button>
          <button class="tab" data-tab="outfits">–û–±—Ä–∞–∑—ã</button>
          <button class="tab" data-tab="inspiration">–ò–¥–µ–∏</button>
          <button class="tab" data-tab="analytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
        </div>
      </div>

      <div class="controls" style="align-self:flex-start">
        <div class="view-toggle" title="–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞">
          <button id="listViewBtn" class="view-btn active" aria-pressed="true" title="–°–ø–∏—Å–æ–∫">‚ò∞</button>
          <button id="gridViewBtn" class="view-btn" aria-pressed="false" title="–°–µ—Ç–∫–∞">‚ñ¶</button>
        </div>
      </div>
    </header>

    <main class="main-grid" id="mainGrid">
      <!-- Left column: multiple sections shown/hidden by tabs -->
      <section>
        <!-- Wardrobe -->
        <div id="wardrobeSection" class="panel">
          <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px">
            <input id="search" type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ —Ç–µ–≥–∞–º" style="flex:1" />
            <select id="filterStatus" class="small">
              <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
              <option value="owned">–¢–æ–ª—å–∫–æ –µ—Å—Ç—å</option>
              <option value="needed">–¢–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ</option>
            </select>
            <select id="filterPriority" class="small">
              <option value="all">–í—Å–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã</option>
              <option value="–∫—Ä–∏—Ç–∏—á–Ω—ã–π">–ö—Ä–∏—Ç–∏—á–Ω—ã–π</option>
              <option value="–≤—ã—Å–æ–∫–∏–π">–í—ã—Å–æ–∫–∏–π</option>
              <option value="—Å—Ä–µ–¥–Ω–∏–π">–°—Ä–µ–¥–Ω–∏–π</option>
              <option value="–Ω–∏–∑–∫–∏–π">–ù–∏–∑–∫–∏–π</option>
            </select>
            <div style="margin-left:auto;display:flex;gap:8px">
              <button id="exportBtn" class="btn ghost">–≠–∫—Å–ø–æ—Ä—Ç</button>
            </div>
          </div>

          <div class="card" style="margin-bottom:12px">
            <h3 style="margin:0 0 8px 0">–î–æ–±–∞–≤–∏—Ç—å –≤–µ—â—å <span class="small muted">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ</span></h3>
            <div style="display:grid;grid-template-columns:1fr 160px 120px;gap:10px;">
              <input id="newName" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–ø—Ä–∏–º–µ—Ä: –ö–æ—Å—Ç—é–º —á–µ—Ä–Ω—ã–π)" />
              <select id="newCategory">
                <option value="suits">–ö–æ—Å—Ç—é–º—ã</option>
                <option value="shirts">–†—É–±–∞—à–∫–∏</option>
                <option value="knitwear">–¢—Ä–∏–∫–æ—Ç–∞–∂</option>
                <option value="polo">–ü–æ–ª–æ</option>
                <option value="pants">–ë—Ä—é–∫–∏</option>
                <option value="shoes">–û–±—É–≤—å</option>
                <option value="accessories">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</option>
              </select>
              <select id="newStatus">
                <option value="–µ—Å—Ç—å">–ï—Å—Ç—å</option>
                <option value="–Ω—É–∂–µ–Ω">–ù—É–∂–µ–Ω</option>
              </select>

              <input id="newTags" type="text" placeholder="–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" style="grid-column:1/span2" />
              <select id="newPriority" style="width:120px">
                <option value="–Ω–∏–∑–∫–∏–π">–ù–∏–∑–∫–∏–π</option>
                <option value="—Å—Ä–µ–¥–Ω–∏–π">–°—Ä–µ–¥–Ω–∏–π</option>
                <option value="–≤—ã—Å–æ–∫–∏–π">–í—ã—Å–æ–∫–∏–π</option>
                <option value="–∫—Ä–∏—Ç–∏—á–Ω—ã–π">–ö—Ä–∏—Ç–∏—á–Ω—ã–π</option>
              </select>

              <textarea id="newNotes" placeholder="–ó–∞–º–µ—Ç–∫–∏" style="grid-column:1/span3"></textarea>
              <div style="grid-column:1/span2">
                <input id="newPhoto" type="file" accept="image/*" />
              </div>
              <div style="display:flex;align-items:center;justify-content:flex-end">
                <button id="addItemBtn" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å</button>
              </div>
            </div>
          </div>

          <!-- list and grid wrappers -->
          <div id="viewContainer" class="list-view">
            <div id="itemsList" class="items-list"></div>
            <div id="itemsGrid" class="items-grid" style="display:none"></div>
          </div>
        </div>

        <!-- Shopping -->
        <div id="shoppingSection" class="panel" style="display:none">
          <div class="card">
            <h3 style="margin-top:0">–®–æ–ø–∏–Ω–≥ ‚Äî –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∫—É–ø–∫—É</h3>
            <div style="display:grid;grid-template-columns:1fr 160px 120px;gap:8px;align-items:center">
              <input id="shopName" type="text" placeholder="–ß—Ç–æ –∫—É–ø–∏—Ç—å (–ø—Ä–∏–º–µ—Ä: –¢—É—Ñ–ª–∏ —á–µ—Ä–Ω—ã–µ)" />
              <select id="shopPriority">
                <option>–ö–†–ò–¢–ò–ß–ù–û</option>
                <option>–í–´–°–û–ö–ò–ô</option>
                <option selected>–°–†–ï–î–ù–ò–ô</option>
                <option>–ù–ò–ó–ö–ò–ô</option>
              </select>
              <input id="shopPrice" type="text" placeholder="–¶–µ–Ω–∞ (–ø—Ä–∏–º–µ—Ä: ‚Ç¨200-300)" />
              <div style="grid-column:1 / span 3; display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
                <button id="addShopBtn" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å –≤ —à–æ–ø–∏–Ω–≥</button>
              </div>
            </div>
          </div>

          <div style="margin-top:12px">
            <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏</h3>
            <div id="activePurchases" style="margin-top:8px"></div>
            <h3 style="margin-top:12px">–ö—É–ø–ª–µ–Ω–æ</h3>
            <div id="completedPurchases" style="margin-top:8px"></div>
          </div>
        </div>

        <!-- Outfits -->
        <div id="outfitsSection" class="panel" style="display:none">
          <div class="card">
            <h3 style="margin-top:0">–°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞–∑</h3>
            <div style="display:grid;grid-template-columns:1fr 160px;gap:8px">
              <input id="outfitName" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞" />
              <select id="outfitSeason">
                <option value="">–°–µ–∑–æ–Ω</option>
                <option value="–ª–µ—Ç–æ">–õ–µ—Ç–æ</option>
                <option value="–∑–∏–º–∞">–ó–∏–º–∞</option>
                <option value="–≤–µ—Å–Ω–∞">–í–µ—Å–Ω–∞</option>
                <option value="–æ—Å–µ–Ω—å">–û—Å–µ–Ω—å</option>
                <option value="–≤—Å–µ—Å–µ–∑–æ–Ω">–í—Å–µ—Å–µ–∑–æ–Ω</option>
              </select>
              <input id="outfitCategory" type="text" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–†–∞–±–æ—Ç–∞, –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏)" />
              <div></div>
              <input id="outfitItems" type="text" placeholder="–í–µ—â–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–ø—Ä–∏–º–µ—Ä: –†—É–±–∞—à–∫–∞ –±–µ–ª–∞—è, –ö–æ—Å—Ç—é–º —á–µ—Ä–Ω—ã–π)" style="grid-column:1/span2" />
              <div style="display:flex;justify-content:flex-end">
                <button id="addOutfitBtn" class="btn primary">–°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞–∑</button>
              </div>
            </div>
          </div>

          <div style="margin-top:12px">
            <h3>–°–ø–∏—Å–æ–∫ –æ–±—Ä–∞–∑–æ–≤</h3>
            <div id="outfitsList" style="margin-top:8px"></div>
          </div>
        </div>

        <!-- Inspiration -->
        <div id="inspirationSection" class="panel" style="display:none">
          <div class="card">
            <h3 style="margin-top:0">–ò–¥–µ–∏ / –°—Å—ã–ª–∫–∏</h3>
            <div style="display:flex;gap:8px">
              <input id="newLink" type="url" placeholder="https://..." style="flex:1" />
              <button id="addLinkBtn" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
          </div>
          <div style="margin-top:12px">
            <div id="linksList"></div>
          </div>
        </div>

        <!-- Analytics -->
        <div id="analyticsSection" class="panel" style="display:none">
          <h3 style="margin-top:0">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
          <div id="analyticsContent"></div>
        </div>
      </section>

      <!-- Sidebar -->
      <aside class="sidebar panel" id="sidebar">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <div>
            <div class="small muted">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <div class="kpi" id="statTotal">‚Äî</div>
          </div>
          <div style="text-align:right">
            <div class="small muted">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å</div>
            <div class="kpi" id="statCompletion">‚Äî</div>
          </div>
        </div>

        <div style="margin-top:10px">
          <div class="small muted">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
          <div id="categoryStats" style="margin-top:8px"></div>
        </div>

        <div style="margin-top:12px">
          <div class="small muted">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–≥–∏</div>
          <div id="topTags" style="margin-top:8px"></div>
        </div>
      </aside>
    </main>
  </div>

  <!-- Edit Modal (hidden by default) -->
  <div id="editModal" style="display:none"></div>

<script>
/* Storage keys */
const STORAGE_KEYS = {
  wardrobe: 'wardrobe-data-v2',
  shopping: 'shopping-data-v2',
  outfits: 'outfits-data-v2',
  links: 'inspiration-data-v2',
  analytics: 'wardrobe-analytics-v1'
};
function safeParse(s){ try{ return JSON.parse(s); } catch(e){return null;} }
function storageGet(k){ try{ const r=localStorage.getItem(k); return r? safeParse(r): null; } catch(e){ return null; } }
function storageSet(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); } catch(e){ console.warn('storageSet', e); } }
function uid(){ return Date.now() + Math.floor(Math.random()*1000); }

/* init defaults if empty (won't overwrite existing data) */
function initDefaults(){
  if(!storageGet(STORAGE_KEYS.wardrobe)){
    storageSet(STORAGE_KEYS.wardrobe, {
      suits:[{id:1,name:'–ö–æ—Å—Ç—é–º —á–µ—Ä–Ω—ã–π –æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π',status:'–µ—Å—Ç—å',priority:'–≤—ã—Å–æ–∫–∏–π',tags:'–æ—Ñ–∏—Å',notes:'',photo:''}],
      shirts:[{id:2,name:'–†—É–±–∞—à–∫–∞ –±–µ–ª–∞—è',status:'–µ—Å—Ç—å',priority:'–Ω–∏–∑–∫–∏–π',tags:'–±–∞–∑–æ–≤—ã–π',notes:'',photo:''}],
      knitwear:[],polo:[],pants:[],shoes:[],accessories:[]
    });
  }
  if(!storageGet(STORAGE_KEYS.shopping)) storageSet(STORAGE_KEYS.shopping, []);
  if(!storageGet(STORAGE_KEYS.outfits)) storageSet(STORAGE_KEYS.outfits, []);
  if(!storageGet(STORAGE_KEYS.links)) storageSet(STORAGE_KEYS.links, []);
  if(!storageGet(STORAGE_KEYS.analytics)) storageSet(STORAGE_KEYS.analytics, []);
}
initDefaults();
let wardrobe = storageGet(STORAGE_KEYS.wardrobe) || {};

/* helpers */
function flatten(w){ return Object.entries(w).flatMap(([cat,items]) => (items||[]).map(i => ({...i, category:cat}))); }
function escapeHtml(s){ if(!s) return ''; return s.replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* --- View mode (list / grid) --- */
let viewMode = 'list'; // 'list' or 'grid'
const listBtn = document.getElementById('listViewBtn');
const gridBtn = document.getElementById('gridViewBtn');
function setView(mode){
  viewMode = mode;
  const viewContainer = document.getElementById('viewContainer');
  if(mode === 'grid'){
    viewContainer.classList.add('grid-view');
    document.getElementById('itemsList').style.display = 'none';
    document.getElementById('itemsGrid').style.display = 'grid';
    listBtn.classList.remove('active'); gridBtn.classList.add('active');
  } else {
    viewContainer.classList.remove('grid-view');
    document.getElementById('itemsList').style.display = 'block';
    document.getElementById('itemsGrid').style.display = 'none';
    listBtn.classList.add('active'); gridBtn.classList.remove('active');
  }
  renderItems();
}
listBtn.addEventListener('click', ()=> setView('list'));
gridBtn.addEventListener('click', ()=> setView('grid'));

/* --- Add item with photo (photo -> base64) --- */
async function addItem(){
  const name = (document.getElementById('newName').value||'').trim();
  if(!name) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–µ—â–∏');
  const category = document.getElementById('newCategory').value;
  const status = document.getElementById('newStatus').value;
  const priority = document.getElementById('newPriority').value;
  const tags = (document.getElementById('newTags').value||'').trim();
  const notes = (document.getElementById('newNotes').value||'').trim();

  // photo
  const fileInput = document.getElementById('newPhoto');
  let photo = '';
  if(fileInput.files && fileInput.files[0]){
    photo = await fileToDataURL(fileInput.files[0]);
  }

  const item = { id: uid(), name, status, priority, tags, notes, photo };
  wardrobe[category] = wardrobe[category] || [];
  wardrobe[category].push(item);
  storageSet(STORAGE_KEYS.wardrobe, wardrobe);
  clearAddForm();
  renderAll();
}

function clearAddForm(){ document.getElementById('newName').value=''; document.getElementById('newTags').value=''; document.getElementById('newNotes').value=''; document.getElementById('newPhoto').value=''; document.getElementById('newPriority').value='–Ω–∏–∑–∫–∏–π'; }

async function fileToDataURL(file){
  return await new Promise(resolve=>{
    const r = new FileReader();
    r.onload = ()=> resolve(r.result);
    r.readAsDataURL(file);
  });
}

/* --- Render items (both modes) --- */
function renderItems(){
  wardrobe = storageGet(STORAGE_KEYS.wardrobe) || wardrobe;
  const items = flatten(wardrobe);
  const search = (document.getElementById('search').value||'').toLowerCase();
  const statusFilter = document.getElementById('filterStatus').value;
  const prFilter = document.getElementById('filterPriority').value;

  let shown = items.slice();
  if(search) shown = shown.filter(i => i.name.toLowerCase().includes(search) || (i.tags||'').toLowerCase().includes(search));
  if(statusFilter==='owned') shown = shown.filter(i => i.status === '–µ—Å—Ç—å');
  if(statusFilter==='needed') shown = shown.filter(i => i.status !== '–µ—Å—Ç—å');
  if(prFilter !== 'all') shown = shown.filter(i => i.priority === prFilter);

  // list
  const listContainer = document.getElementById('itemsList'); listContainer.innerHTML = '';
  // grid
  const gridContainer = document.getElementById('itemsGrid'); gridContainer.innerHTML = '';

  if(shown.length === 0){
    listContainer.innerHTML = '<div class="muted">–ù–µ—Ç –≤–µ—â–µ–π –¥–ª—è –ø–æ–∫–∞–∑–∞.</div>';
    gridContainer.innerHTML = '<div class="muted">–ù–µ—Ç –≤–µ—â–µ–π –¥–ª—è –ø–æ–∫–∞–∑–∞.</div>';
    return;
  }

  shown.forEach(it=>{
    // LIST ITEM
    const listEl = document.createElement('div'); listEl.className = 'item';
    const photoEl = document.createElement('div'); photoEl.className='item-photo';
    if(it.photo){
      const img = document.createElement('img'); img.src = it.photo; img.alt=''; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover'; img.style.borderRadius='8px';
      photoEl.appendChild(img);
    } else {
      photoEl.textContent = 'üñº';
    }
    const info = document.createElement('div'); info.style.flex='1';
    const title = document.createElement('div'); title.className='title'; title.innerHTML = `<strong>${escapeHtml(it.name)}</strong> <span class="muted">(${escapeHtml(it.category)})</span>`;
    const meta = document.createElement('div'); meta.style.marginTop='6px';
    const statusBadge = `<span class="badge ${it.status==='–µ—Å—Ç—å'?'green':'red'}">${it.status==='–µ—Å—Ç—å'?'–ï—Å—Ç—å':'–ù—É–∂–Ω–æ'}</span>`;
    const prColor = it.priority==='–∫—Ä–∏—Ç–∏—á–Ω—ã–π' ? '#7f1d1d' : it.priority==='–≤—ã—Å–æ–∫–∏–π' ? '#9a3412' : it.priority==='—Å—Ä–µ–¥–Ω–∏–π' ? '#713f12' : '#374151';
    const prBadge = `<span class="badge" style="background:${prColor};color:#fff;margin-left:8px">${escapeHtml(it.priority)}</span>`;
    meta.innerHTML = statusBadge + prBadge;
    const tagRow = document.createElement('div'); tagRow.className='muted'; tagRow.style.marginTop='8px'; tagRow.textContent = it.tags? '#' + it.tags.split(',')[0] : '';
    const actions = document.createElement('div'); actions.style.marginTop='10px'; actions.style.display='flex'; actions.style.gap='8px';
    const editBtn = document.createElement('button'); editBtn.className='btn ghost'; editBtn.textContent='–ò–∑–º–µ–Ω–∏—Ç—å'; editBtn.onclick = ()=> openEditModal(it.id);
    const delBtn = document.createElement('button'); delBtn.className='btn ghost'; delBtn.textContent='–£–¥–∞–ª–∏—Ç—å'; delBtn.onclick = ()=> { if(confirm('–£–¥–∞–ª–∏—Ç—å –≤–µ—â—å?')) deleteItem(it.id); };
    actions.appendChild(editBtn); actions.appendChild(delBtn);

    info.appendChild(title); info.appendChild(meta); info.appendChild(tagRow); info.appendChild(actions);
    listEl.appendChild(photoEl); listEl.appendChild(info);
    listContainer.appendChild(listEl);

    // GRID CARD
    const card = document.createElement('div'); card.className='grid-card';
    const photoWrap = document.createElement('div'); photoWrap.className='card-photo';
    if(it.photo){
      const img = document.createElement('img'); img.src = it.photo; img.alt=''; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover';
      photoWrap.appendChild(img);
    } else {
      photoWrap.textContent = 'üñº';
    }
    const body = document.createElement('div'); body.className='card-body';
    body.innerHTML = `<div class="grid-title">${escapeHtml(it.name)}</div>
                      <div class="grid-meta"><div class="muted">${escapeHtml(it.category)}</div><div>${it.status==='–µ—Å—Ç—å'?'<span class="badge green">–ï—Å—Ç—å</span>':'<span class="badge red">–ù—É–∂–Ω–æ</span>'}</div></div>`;
    const cardActions = document.createElement('div'); cardActions.style.display='flex'; cardActions.style.gap='8px'; cardActions.style.marginTop='10px';
    const e2 = document.createElement('button'); e2.className='btn ghost'; e2.textContent='–ò–∑–º–µ–Ω–∏—Ç—å'; e2.onclick = ()=> openEditModal(it.id);
    const d2 = document.createElement('button'); d2.className='btn ghost'; d2.textContent='–£–¥–∞–ª–∏—Ç—å'; d2.onclick = ()=> { if(confirm('–£–¥–∞–ª–∏—Ç—å –≤–µ—â—å?')) deleteItem(it.id); };
    cardActions.appendChild(e2); cardActions.appendChild(d2);
    body.appendChild(cardActions);
    card.appendChild(photoWrap); card.appendChild(body);
    gridContainer.appendChild(card);
  });
}

/* --- Delete and edit with photo support --- */
function deleteItem(id){
  Object.keys(wardrobe).forEach(cat=>{
    wardrobe[cat] = (wardrobe[cat]||[]).filter(i=>i.id!==id);
  });
  storageSet(STORAGE_KEYS.wardrobe, wardrobe);
  renderAll();
}

function openEditModal(id){
  // find item
  let item = null, catKey = null;
  for(const [cat,arr] of Object.entries(wardrobe)){
    const found = (arr||[]).find(i=>i.id===id);
    if(found){ item = found; catKey = cat; break; }
  }
  if(!item) return alert('–í–µ—â—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');

  const modalRoot = document.getElementById('editModal');
  modalRoot.innerHTML = '';
  modalRoot.style.display = 'block';
  const backdrop = document.createElement('div'); backdrop.className='modal-backdrop';
  const modal = document.createElement('div'); modal.className='modal';

  modal.innerHTML = `
    <h3>–ò–∑–º–µ–Ω–∏—Ç—å –≤–µ—â—å</h3>
    <div style="display:grid;grid-template-columns:1fr 160px;gap:8px;margin-top:8px">
      <input id="editName" type="text" value="${escapeHtml(item.name)}" />
      <select id="editCategory">
        <option value="suits">–ö–æ—Å—Ç—é–º—ã</option><option value="shirts">–†—É–±–∞—à–∫–∏</option><option value="knitwear">–¢—Ä–∏–∫–æ—Ç–∞–∂</option><option value="polo">–ü–æ–ª–æ</option><option value="pants">–ë—Ä—é–∫–∏</option><option value="shoes">–û–±—É–≤—å</option><option value="accessories">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</option>
      </select>
      <select id="editStatus"><option value="–µ—Å—Ç—å">–ï—Å—Ç—å</option><option value="–Ω—É–∂–µ–Ω">–ù—É–∂–µ–Ω</option></select>
      <select id="editPriority"><option value="–Ω–∏–∑–∫–∏–π">–ù–∏–∑–∫–∏–π</option><option value="—Å—Ä–µ–¥–Ω–∏–π">–°—Ä–µ–¥–Ω–∏–π</option><option value="–≤—ã—Å–æ–∫–∏–π">–í—ã—Å–æ–∫–∏–π</option><option value="–∫—Ä–∏—Ç–∏—á–Ω—ã–π">–ö—Ä–∏—Ç–∏—á–Ω—ã–π</option></select>
      <input id="editTags" type="text" value="${escapeHtml(item.tags||'')}" style="grid-column:1/span2" />
      <textarea id="editNotes" style="grid-column:1/span2">${escapeHtml(item.notes||'')}</textarea>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="editPhotoInput" type="file" accept="image/*" />
      </div>
      <div style="display:flex;justify-content:flex-end;align-items:center">
        <button id="saveEditBtn" class="btn primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
    <div style="margin-top:12px" id="currentPhotoArea"></div>
  `;

  backdrop.appendChild(modal);
  modalRoot.appendChild(backdrop);

  // set current category/status/priority
  document.getElementById('editCategory').value = catKey;
  document.getElementById('editStatus').value = item.status || '–µ—Å—Ç—å';
  document.getElementById('editPriority').value = item.priority || '–Ω–∏–∑–∫–∏–π';

  const curArea = document.getElementById('currentPhotoArea');
  curArea.innerHTML = '';
  if(item.photo){
    const wrap = document.createElement('div'); wrap.className='photo-preview';
    const img = document.createElement('img'); img.src = item.photo; img.style.width='180px'; img.style.height='180px'; img.style.objectFit='cover'; img.style.borderRadius='8px';
    const delBtn = document.createElement('button'); delBtn.className='del-photo'; delBtn.textContent='‚úï'; delBtn.title='–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ';
    delBtn.onclick = ()=> {
      if(!confirm('–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ?')) return;
      item.photo = '';
      // update storage
      storageSet(STORAGE_KEYS.wardrobe, wardrobe);
      curArea.innerHTML = '<div class="muted">–§–æ—Ç–æ —É–¥–∞–ª–µ–Ω–æ</div>';
    };
    wrap.appendChild(img); wrap.appendChild(delBtn);
    curArea.appendChild(wrap);
  } else {
    curArea.innerHTML = '<div class="muted">–§–æ—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</div>';
  }

  // save handler
  document.getElementById('saveEditBtn').onclick = async ()=>{
    const newName = (document.getElementById('editName').value||'').trim();
    if(!newName) return alert('–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º');
    const newCat = document.getElementById('editCategory').value;
    const newStatus = document.getElementById('editStatus').value;
    const newPriority = document.getElementById('editPriority').value;
    const newTags = (document.getElementById('editTags').value||'').trim();
    const newNotes = (document.getElementById('editNotes').value||'').trim();
    // handle new photo
    const phInput = document.getElementById('editPhotoInput');
    if(phInput.files && phInput.files[0]){
      const data = await fileToDataURL(phInput.files[0]);
      item.photo = data;
    }
    // if category changed, move item
    if(newCat !== catKey){
      // remove from old
      wardrobe[catKey] = (wardrobe[catKey]||[]).filter(i => i.id !== item.id);
      item.name = newName; item.status=newStatus; item.priority=newPriority; item.tags=newTags; item.notes=newNotes;
      wardrobe[newCat] = wardrobe[newCat] || [];
      wardrobe[newCat].push(item);
    } else {
      Object.assign(item, { name:newName, status:newStatus, priority:newPriority, tags:newTags, notes:newNotes });
    }
    storageSet(STORAGE_KEYS.wardrobe, wardrobe);
    closeEditModal();
    renderAll();
  };

  // close on backdrop click
  backdrop.addEventListener('click', (e)=>{ if(e.target===backdrop) closeEditModal(); });
}

function closeEditModal(){ const modalRoot=document.getElementById('editModal'); modalRoot.innerHTML=''; modalRoot.style.display='none'; }

/* --- Shopping functions --- */
document.getElementById('addShopBtn').addEventListener('click', ()=>{
  const item = (document.getElementById('shopName').value||'').trim(); if(!item) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏');
  const priority = document.getElementById('shopPriority').value; const price = document.getElementById('shopPrice').value;
  const list = storageGet(STORAGE_KEYS.shopping) || [];
  const obj = { id: uid(), item, priority, price, category:'', plannedDate:'', purchased:false };
  list.push(obj); storageSet(STORAGE_KEYS.shopping, list);
  document.getElementById('shopName').value=''; document.getElementById('shopPrice').value='';
  renderShopping();
});

function renderShopping(){
  const s = storageGet(STORAGE_KEYS.shopping) || [];
  const active = s.filter(i=>!i.purchased);
  const completed = s.filter(i=>i.purchased);
  const actCont = document.getElementById('activePurchases'); actCont.innerHTML='';
  active.forEach(i=>{
    const d = document.createElement('div'); d.className='item';
    d.innerHTML = `<div style="flex:1"><div><strong>${escapeHtml(i.item)}</strong> <span class="muted small">${escapeHtml(i.priority)} ${i.price? '‚Äî ' + escapeHtml(i.price): ''}</span></div></div>`;
    const actions = document.createElement('div'); actions.style.display='flex'; actions.style.gap='6px';
    const tog = document.createElement('button'); tog.className='btn ghost small'; tog.textContent='–ö—É–ø–ª–µ–Ω–æ'; tog.onclick = ()=> togglePurchased(i.id);
    const rem = document.createElement('button'); rem.className='btn ghost small'; rem.textContent='–£–¥–∞–ª–∏—Ç—å'; rem.onclick = ()=> removeShopping(i.id);
    actions.appendChild(tog); actions.appendChild(rem);
    d.appendChild(actions);
    actCont.appendChild(d);
  });
  const compCont = document.getElementById('completedPurchases'); compCont.innerHTML='';
  completed.forEach(i=>{
    const d = document.createElement('div'); d.className='item';
    d.innerHTML = `<div style="flex:1"><div><strong style="text-decoration:line-through">${escapeHtml(i.item)}</strong> <span class="muted small">${i.purchasedDate||''}</span></div></div>`;
    const rem = document.createElement('button'); rem.className='btn ghost small'; rem.textContent='–£–¥–∞–ª–∏—Ç—å'; rem.onclick = ()=> removeShopping(i.id);
    d.appendChild(rem); compCont.appendChild(d);
  });
}
function removeShopping(id){ let list=storageGet(STORAGE_KEYS.shopping)||[]; list=list.filter(i=>i.id!==id); storageSet(STORAGE_KEYS.shopping,list); renderShopping(); }
function togglePurchased(id){ let list=storageGet(STORAGE_KEYS.shopping)||[]; list=list.map(i=>i.id===id?{...i,purchased:!i.purchased,purchasedDate:!i.purchased? (new Date()).toISOString().split('T')[0] : null}:i); storageSet(STORAGE_KEYS.shopping,list); renderShopping(); }

/* --- Outfits --- */
document.getElementById('addOutfitBtn').addEventListener('click', ()=>{
  const name=(document.getElementById('outfitName').value||'').trim(); if(!name) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞');
  const category=document.getElementById('outfitCategory').value; const season=document.getElementById('outfitSeason').value;
  const items=(document.getElementById('outfitItems').value||'').split(',').map(s=>s.trim()).filter(Boolean);
  const list = storageGet(STORAGE_KEYS.outfits) || []; list.push({id:uid(),name,category,season,items,created:new Date().toISOString()}); storageSet(STORAGE_KEYS.outfits,list);
  document.getElementById('outfitName').value=''; document.getElementById('outfitItems').value=''; renderOutfits();
});
function renderOutfits(){
  const list = storageGet(STORAGE_KEYS.outfits) || [];
  const cont = document.getElementById('outfitsList'); cont.innerHTML='';
  if(list.length===0){ cont.innerHTML='<div class="muted">–ù–µ—Ç –æ–±—Ä–∞–∑–æ–≤</div>'; return; }
  const w = storageGet(STORAGE_KEYS.wardrobe) || wardrobe;
  const all = flatten(w);
  list.forEach(o=>{
    const check = o.items.map(it=>({item:it, have: all.some(wi => wi.name.toLowerCase().includes(it.toLowerCase()) && wi.status==='–µ—Å—Ç—å')}));
    const div = document.createElement('div'); div.className='card'; div.style.marginBottom='8px';
    div.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>${escapeHtml(o.name)}</strong> <span class="muted">${escapeHtml(o.category||'')}</span></div><div><button class="btn ghost small">–£–¥–∞–ª–∏—Ç—å</button></div></div>`;
    const listEl = document.createElement('div'); listEl.style.marginTop='8px';
    check.forEach(c=>{ const row=document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.innerHTML=`<div class="small">${escapeHtml(c.item)}</div><div class="small ${c.have?'':'muted'}">${c.have?'–ï—Å—Ç—å':'–ù—É–∂–Ω–æ'}</div>`; listEl.appendChild(row); });
    div.appendChild(listEl);
    const delBtn = div.querySelector('button'); delBtn.onclick = ()=> { if(confirm('–£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑?')) { deleteOutfit(o.id); } };
    cont.appendChild(div);
  });
}
function deleteOutfit(id){ let l=storageGet(STORAGE_KEYS.outfits)||[]; l=l.filter(o=>o.id!==id); storageSet(STORAGE_KEYS.outfits,l); renderOutfits(); }

/* --- Links --- */
document.getElementById('addLinkBtn').addEventListener('click', ()=>{
  const url=(document.getElementById('newLink').value||'').trim(); if(!url) return alert('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É');
  const list = storageGet(STORAGE_KEYS.links)||[]; list.push({id:uid(),url}); storageSet(STORAGE_KEYS.links,list); document.getElementById('newLink').value=''; renderLinks();
});
function renderLinks(){ const list = storageGet(STORAGE_KEYS.links)||[]; const cont=document.getElementById('linksList'); cont.innerHTML=''; if(list.length===0){ cont.innerHTML='<div class="muted">–°—Å—ã–ª–æ–∫ –Ω–µ—Ç</div>'; return;} list.forEach(l=>{ const d=document.createElement('div'); d.className='item'; d.innerHTML=`<div style="flex:1"><a href="${escapeHtml(l.url)}" target="_blank" rel="noopener noreferrer" class="small">${escapeHtml(l.url)}</a></div>`; const del=document.createElement('button'); del.className='btn ghost small'; del.textContent='–£–¥–∞–ª–∏—Ç—å'; del.onclick=()=>{ let arr=storageGet(STORAGE_KEYS.links)||[]; arr=arr.filter(x=>x.id!==l.id); storageSet(STORAGE_KEYS.links,arr); renderLinks(); }; d.appendChild(del); cont.appendChild(d); }); }

/* --- Analytics view --- */
function renderAnalyticsView(){
  const items = flatten(storageGet(STORAGE_KEYS.wardrobe) || wardrobe);
  const s = { total: items.length, owned: items.filter(i=>i.status==='–µ—Å—Ç—å').length, needed: items.filter(i=>i.status!=='–µ—Å—Ç—å').length, critical: items.filter(i => (i.priority||'').toString().toLowerCase().includes('–∫—Ä–∏—Ç')).length };
  const events = storageGet(STORAGE_KEYS.analytics) || [];
  const container = document.getElementById('analyticsContent');
  container.innerHTML = `<div class="card"><div style="display:flex;gap:16px;flex-wrap:wrap"><div style="min-width:140px"><div class="small muted">–í—Å–µ–≥–æ –≤–µ—â–µ–π</div><div class="kpi">${s.total}</div></div><div style="min-width:140px"><div class="small muted">–ï—Å—Ç—å</div><div class="kpi">${s.owned}</div></div><div style="min-width:140px"><div class="small muted">–ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å</div><div class="kpi">${s.needed}</div></div><div style="min-width:140px"><div class="small muted">–ö—Ä–∏—Ç–∏—á–Ω—ã—Ö</div><div class="kpi">${s.critical}</div></div><div style="min-width:140px"><div class="small muted">–°–æ–±—ã—Ç–∏–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</div><div class="kpi">${events.length}</div></div></div></div>`;
}

/* --- sidebar and totals --- */
function renderSidebar(){
  const items = flatten(storageGet(STORAGE_KEYS.wardrobe) || wardrobe);
  const total = items.length;
  const owned = items.filter(i=>i.status==='–µ—Å—Ç—å').length;
  const completion = total? Math.round((owned/total)*100):0;
  document.getElementById('statTotal').textContent = `${total} –≤–µ—â–µ–π`;
  document.getElementById('statCompletion').textContent = `${completion}%`;

  // categories stats
  const cats = Object.entries(storageGet(STORAGE_KEYS.wardrobe) || wardrobe).map(([cat,arr])=>{ const tot=(arr||[]).length; const own=(arr||[]).filter(i=>i.status==='–µ—Å—Ç—å').length; const percent=tot?Math.round((own/tot)*100):0; return {cat,tot,own,percent}; });
  const catCont=document.getElementById('categoryStats'); catCont.innerHTML=''; cats.forEach(c=>{ const r=document.createElement('div'); r.style.marginBottom='10px'; r.innerHTML=`<div style="display:flex;justify-content:space-between"><div class="small">${escapeHtml(c.cat)}</div><div class="small">${c.own}/${c.tot}</div></div><div class="progress" style="margin-top:6px"><i style="width:${c.percent}%"></i></div>`; catCont.appendChild(r); });

  // top tags
  const tags = getTopTags(10); const tagsCont = document.getElementById('topTags'); tagsCont.innerHTML=''; if(tags.length===0) tagsCont.innerHTML='<div class="muted">–ù–µ—Ç —Ç–µ–≥–æ–≤</div>'; tags.forEach(t=>{ const el=document.createElement('div'); el.className='small muted'; el.textContent = `#${t.tag} ‚Äî ${t.count}`; tagsCont.appendChild(el); });
}

function getTopTags(topN=10){ const all = flatten(storageGet(STORAGE_KEYS.wardrobe) || wardrobe); const map={}; all.forEach(i=>{ (i.tags||'').split(',').map(t=>t.trim().toLowerCase()).filter(Boolean).forEach(t=> map[t]=(map[t]||0)+1); }); return Object.entries(map).sort((a,b)=>b[1]-a[1]).slice(0,topN).map(([tag,count])=>({tag,count})); }

/* --- Export --- */
async function exportFullReport(){
  const items = flatten(storageGet(STORAGE_KEYS.wardrobe) || wardrobe);
  const total = items.length; const owned = items.filter(i=>i.status==='–µ—Å—Ç—å').length;
  let txt = `–û—Ç—á—ë—Ç: –ú–æ–π –≥–∞—Ä–¥–µ—Ä–æ–±\n–î–∞—Ç–∞: ${new Date().toISOString()}\n\n–í—Å–µ–≥–æ: ${total}\n–ï—Å—Ç—å: ${owned}\n\n–°–ø–∏—Å–æ–∫:\n`;
  items.forEach(i=> txt += `- ${i.name} (${i.category}) ${i.status} ${i.priority} ${i.tags? ' #' + i.tags : ''}\n`);
  const blob = new Blob([txt], { type: 'text/plain;charset=utf-8' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'wardrobe-report.txt'; a.click(); URL.revokeObjectURL(url);
}

/* --- UI hooks --- */
document.getElementById('addItemBtn').addEventListener('click', addItem);
document.getElementById('search').addEventListener('input', ()=> renderItems());
document.getElementById('filterStatus').addEventListener('change', ()=> renderItems());
document.getElementById('filterPriority').addEventListener('change', ()=> renderItems());

document.getElementById('exportBtn').addEventListener('click', exportFullReport);

/* Tabs switching */
const tabs = document.querySelectorAll('.tab');
function showTab(name){
  ['wardrobe','shopping','outfits','inspiration','analytics'].forEach(id=>{
    const el = document.getElementById(id + 'Section');
    if(el) el.style.display = (id === name) ? 'block' : 'none';
  });
  tabs.forEach(t=> t.classList.toggle('active', t.dataset.tab === name));
  // render specific
  if(name === 'shopping') renderShopping();
  if(name === 'outfits') renderOutfits();
  if(name === 'inspiration') renderLinks();
  if(name === 'analytics') renderAnalyticsView();
  if(name === 'wardrobe') renderItems();
}
tabs.forEach(t => t.addEventListener('click', ()=> showTab(t.dataset.tab)));

/* initial render */
function renderAll(){ wardrobe = storageGet(STORAGE_KEYS.wardrobe) || wardrobe; renderItems(); renderSidebar(); renderShopping(); renderOutfits(); renderLinks(); renderAnalyticsView(); }
renderAll();
setView('list');

/* expose for inline onclicks */
window.openEditModal = openEditModal;
window.deleteItem = deleteItem;

/* ensure mobile toolbar visibility (kept simple) */
function updateMobileToolbar(){ /* placeholder if needed */ }
window.addEventListener('resize', updateMobileToolbar);

/* close modal on escape */
window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeEditModal(); });

</script>
</body>
</html>
