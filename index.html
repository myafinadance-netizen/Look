<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>–ú–æ–π –≥–∞—Ä–¥–µ—Ä–æ–± ‚Äî –í–µ–± (Analytics + Recommendations + Reminders)</title>
  <meta name="description" content="–ì–∞—Ä–¥–µ—Ä–æ–± —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏, –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–º –æ–±—Ä–∞–∑–æ–≤ –∏ –∏—Å—Ç–æ—Ä–∏–µ–π. –†–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å Supabase." />
  <style>
    :root{
      --bg-0:#06101a; --bg-1:#0b1220; --panel:#0f1720; --muted:#9CA3AF;
      --accent:#dc2626; --accent-2:#06b6d4; --card-border:rgba(255,255,255,0.04);
      --radius:12px; --gap:14px; --max-width:1200px; --safe-top:env(safe-area-inset-top,0px);
      --success:#10b981; --danger:#ef4444; --accent-3:#f59e0b;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-0),var(--bg-1));color:#e6eef6;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;-webkit-font-smoothing:antialiased}
    .wrap{max-width:var(--max-width);margin:calc(18px + var(--safe-top)) auto 60px;padding:16px}
    header{display:flex;align-items:flex-start;gap:16px;margin-bottom:12px}
    h1{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}
    .tabs{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
    .tab{padding:8px 12px;border-radius:8px;background:transparent;border:1px solid transparent;color:var(--muted);cursor:pointer;font-size:13px}
    .tab.active{background:rgba(255,255,255,0.03);color:#fff;border-color:var(--card-border)}
    .main-grid{display:grid;grid-template-columns:1fr 340px;gap:var(--gap);align-items:start}
    .panel{background:var(--panel);border-radius:var(--radius);padding:14px;border:1px solid var(--card-border);box-shadow:0 8px 28px rgba(0,0,0,0.45)}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
    input[type="text"], input[type="url"], input[type="date"], textarea, select{width:100%;padding:9px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(0,0,0,0.35);color:#fff;font-size:14px}
    textarea{min-height:64px;resize:vertical}
    .btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .muted{color:var(--muted);font-size:13px}
    .flex{display:flex;gap:8px;align-items:center}
    .ml-auto{margin-left:auto}
    .kpi{font-size:20px;font-weight:700}
    .badge{display:inline-block;padding:5px 8px;border-radius:999px;font-size:12px}
    .badge.green{background:var(--success);color:#04291a}
    .badge.red{background:var(--danger);color:#fff}
    .badge.yellow{background:var(--accent-3);color:#2b1600}
    /* list/grid view */
    .view-controls{display:flex;gap:8px;align-items:center}
    .view-btn{padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer;color:var(--muted)}
    .view-btn.active{background:rgba(255,255,255,0.03);color:#fff;border-color:var(--card-border)}
    .items-list{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .item{display:flex;gap:12px;align-items:flex-start;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
    .item-photo{width:76px;height:76px;border-radius:8px;flex-shrink:0;object-fit:cover;background:#071018;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:28px}
    .items-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:12px}
    .grid-card{background:var(--panel);border-radius:12px;overflow:hidden;border:1px solid var(--card-border);transition:transform .18s ease,box-shadow .18s ease}
    .grid-card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,0.6)}
    .card-photo{width:100%;height:180px;object-fit:cover;background:#071018;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:34px}
    .card-body{padding:10px}
    .small{font-size:13px;color:var(--muted)}
    .note{font-size:13px;color:var(--muted);margin-top:6px}
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:1000}
    .modal{background:var(--panel);border-radius:10px;padding:12px;max-width:760px;width:96%;box-shadow:0 12px 40px rgba(0,0,0,0.6);border:1px solid var(--card-border)}
    .photo-preview{position:relative;display:inline-block;margin-right:10px}
    .photo-preview img{width:160px;height:160px;object-fit:cover;border-radius:8px}
    .del-photo{position:absolute;right:6px;top:6px;background:rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.06);color:#fff;border-radius:999px;padding:4px 6px;cursor:pointer}
    /* responsive */
    @media (max-width:1000px){ .main-grid{grid-template-columns:1fr 300px} .items-grid{grid-template-columns:repeat(3,1fr)} }
    @media (max-width:700px){ .items-grid{grid-template-columns:repeat(2,1fr)} .item-photo{width:56px;height:56px} .card-photo{height:140px} }
    @media (max-width:480px){ .main-grid{grid-template-columns:1fr} .sidebar{order:2} .items-grid{grid-template-columns:repeat(2,1fr)} .card-photo{height:120px} }
    :focus{outline:2px solid rgba(6,182,212,0.18);outline-offset:2px}
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <header>
      <div style="flex:1">
        <h1>–ú–æ–π –≥–∞—Ä–¥–µ—Ä–æ–± ‚Äî Web</h1>
        <div class="subtitle">Analytics, Recommendations, Reminders, Outfits, Calendar. –†–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Supabase.</div>

        <div class="tabs" aria-label="–†–∞–∑–¥–µ–ª—ã" style="margin-top:12px">
          <button class="tab active" data-tab="wardrobe">–ì–∞—Ä–¥–µ—Ä–æ–±</button>
          <button class="tab" data-tab="shopping">–®–æ–ø–∏–Ω–≥</button>
          <button class="tab" data-tab="outfits">–û–±—Ä–∞–∑—ã</button>
          <button class="tab" data-tab="analytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
          <button class="tab" data-tab="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <div class="view-controls" title="–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞">
          <button id="listViewBtn" class="view-btn active" aria-pressed="true" title="–°–ø–∏—Å–æ–∫">‚ò∞</button>
          <button id="gridViewBtn" class="view-btn" aria-pressed="false" title="–°–µ—Ç–∫–∞">‚ñ¶</button>
        </div>
      </div>
    </header>

    <main class="main-grid" id="mainGrid">
      <!-- Left column: multiple sections -->
      <section>
        <!-- Wardrobe section -->
        <div id="wardrobeSection" class="panel">
          <div style="display:flex;gap:10px;align-items:center;margin-bottom:10px">
            <input id="search" type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ —Ç–µ–≥–∞–º" style="flex:1" />
            <select id="filterStatus">
              <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
              <option value="–µ—Å—Ç—å">–¢–æ–ª—å–∫–æ –µ—Å—Ç—å</option>
              <option value="–Ω—É–∂–µ–Ω">–¢–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ</option>
            </select>
            <select id="filterPriority">
              <option value="all">–í—Å–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã</option>
              <option value="–∫—Ä–∏—Ç–∏—á–Ω—ã–π">–ö—Ä–∏—Ç–∏—á–Ω—ã–π</option>
              <option value="–≤—ã—Å–æ–∫–∏–π">–í—ã—Å–æ–∫–∏–π</option>
              <option value="—Å—Ä–µ–¥–Ω–∏–π">–°—Ä–µ–¥–Ω–∏–π</option>
              <option value="–Ω–∏–∑–∫–∏–π">–ù–∏–∑–∫–∏–π</option>
            </select>
            <div class="ml-auto">
              <button id="exportJsonBtn" class="btn ghost">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
              <button id="importJsonBtn" class="btn ghost">–ò–º–ø–æ—Ä—Ç</button>
            </div>
          </div>

          <div class="card" style="margin-bottom:10px">
            <h3 style="margin:0 0 8px 0">–î–æ–±–∞–≤–∏—Ç—å –≤–µ—â—å <span class="small muted">(photo —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage –∫–∞–∫ base64)</span></h3>
            <div style="display:grid;grid-template-columns:1fr 160px 120px;gap:10px">
              <input id="newName" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–ø—Ä–∏–º–µ—Ä: –ö–æ—Å—Ç—é–º —á–µ—Ä–Ω—ã–π)" />
              <select id="newCategory">
                <option value="suits">–ö–æ—Å—Ç—é–º—ã</option>
                <option value="shirts">–†—É–±–∞—à–∫–∏</option>
                <option value="knitwear">–¢—Ä–∏–∫–æ—Ç–∞–∂</option>
                <option value="polo">–ü–æ–ª–æ</option>
                <option value="pants">–ë—Ä—é–∫–∏</option>
                <option value="shoes">–û–±—É–≤—å</option>
                <option value="accessories">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</option>
              </select>
              <select id="newStatus">
                <option value="–µ—Å—Ç—å">–ï—Å—Ç—å</option>
                <option value="–Ω—É–∂–µ–Ω">–ù—É–∂–µ–Ω</option>
              </select>

              <input id="newTags" type="text" placeholder="–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" style="grid-column:1/span2" />
              <select id="newPriority" style="width:120px">
                <option value="–Ω–∏–∑–∫–∏–π">–ù–∏–∑–∫–∏–π</option>
                <option value="—Å—Ä–µ–¥–Ω–∏–π">–°—Ä–µ–¥–Ω–∏–π</option>
                <option value="–≤—ã—Å–æ–∫–∏–π">–í—ã—Å–æ–∫–∏–π</option>
                <option value="–∫—Ä–∏—Ç–∏—á–Ω—ã–π">–ö—Ä–∏—Ç–∏—á–Ω—ã–π</option>
              </select>

              <textarea id="newNotes" placeholder="–ó–∞–º–µ—Ç–∫–∏" style="grid-column:1/span3"></textarea>
              <div style="grid-column:1/span2">
                <input id="newPhoto" type="file" accept="image/*" />
              </div>
              <div style="display:flex;align-items:center;justify-content:flex-end">
                <button id="addItemBtn" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å</button>
              </div>
            </div>
          </div>

          <div id="views">
            <div id="listView">
              <div id="itemsList" class="items-list"></div>
            </div>
            <div id="gridView" style="display:none">
              <div id="itemsGrid" class="items-grid"></div>
            </div>
          </div>
        </div>

        <!-- Shopping -->
        <div id="shoppingSection" class="panel" style="display:none;margin-top:14px">
          <div class="card">
            <h3 style="margin:0 0 8px 0">–®–æ–ø–∏–Ω–≥ ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–∫—É–ø–∫—É</h3>
            <div style="display:grid;grid-template-columns:1fr 140px 120px;gap:8px">
              <input id="shopName" type="text" placeholder="–ß—Ç–æ –∫—É–ø–∏—Ç—å" />
              <select id="shopPriority">
                <option>–ö–†–ò–¢–ò–ß–ù–û</option>
                <option>–í–´–°–û–ö–ò–ô</option>
                <option selected>–°–†–ï–î–ù–ò–ô</option>
                <option>–ù–ò–ó–ö–ò–ô</option>
              </select>
              <input id="shopPrice" type="text" placeholder="–¶–µ–Ω–∞" />
              <div style="grid-column:1/span3;display:flex;justify-content:flex-end;margin-top:8px">
                <input id="shopPlannedDate" type="date" style="margin-right:8px" />
                <button id="addShopBtn" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å –≤ —à–æ–ø–∏–Ω–≥</button>
              </div>
            </div>
          </div>

          <div style="margin-top:12px">
            <h4>–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏</h4>
            <div id="activePurchases"></div>
            <h4 style="margin-top:12px">–ö—É–ø–ª–µ–Ω–æ</h4>
            <div id="completedPurchases"></div>
          </div>
        </div>

        <!-- Outfits & Calendar -->
        <div id="outfitsSection" class="panel" style="display:none;margin-top:14px">
          <div class="card">
            <h3 style="margin:0 0 8px 0">–°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞–∑</h3>
            <div style="display:grid;grid-template-columns:1fr 140px;gap:8px">
              <input id="outfitName" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞ (–ø—Ä–∏–º–µ—Ä: –û—Ñ–∏—Å–Ω—ã–π)" />
              <select id="outfitSeason">
                <option value="">–°–µ–∑–æ–Ω</option><option value="–ª–µ—Ç–æ">–õ–µ—Ç–æ</option><option value="–∑–∏–º–∞">–ó–∏–º–∞</option><option value="–≤—Å–µ—Å–µ–∑–æ–Ω">–í—Å–µ—Å–µ–∑–æ–Ω</option>
              </select>
              <input id="outfitItems" type="text" placeholder="–°–ø–∏—Å–æ–∫ –≤–µ—â–µ–π —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (—Å —Ç–æ—á–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏–ª–∏ —á–∞—Å—Ç—å)" style="grid-column:1/span2" />
              <div style="display:flex;justify-content:flex-end">
                <button id="addOutfitBtn" class="btn primary">–°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞–∑</button>
              </div>
            </div>
          </div>

          <div style="margin-top:12px">
            <h4>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ–±—Ä–∞–∑–æ–≤ (–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–º–µ—é—â–∏—Ö—Å—è –≤–µ—â–µ–π)</h4>
            <div class="card">
              <div style="display:flex;gap:8px;align-items:center">
                <select id="generatorOccasion"><option value="">–í—Å–µ</option><option value="—Ä–∞–±–æ—Ç–∞">–†–∞–±–æ—Ç–∞</option><option value="—Å–ø–æ—Ä—Ç">–°–ø–æ—Ä—Ç</option><option value="–≤–µ—á–µ—Ä">–í–µ—á–µ—Ä</option></select>
                <button id="generateBtn" class="btn ghost">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</button>
                <div class="ml-auto small muted">–í—ã–±–æ—Ä –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö –∏ —Ç–µ–≥–∞—Ö</div>
              </div>
              <div id="generatedOutfits" style="margin-top:8px"></div>
            </div>
          </div>

          <div style="margin-top:12px">
            <h4>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –æ–±—Ä–∞–∑–æ–≤ ‚Äî –ø–ª–∞–Ω –Ω–∞ –Ω–µ–¥–µ–ª—é</h4>
            <div class="card" id="weekPlanner" style="display:grid;grid-template-columns:repeat(7,1fr);gap:8px;padding:12px">
              <!-- days injected here -->
            </div>
            <div class="small muted" style="margin-top:8px">–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–µ–Ω—å, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –¥–ª—è —ç—Ç–æ–≥–æ –¥–Ω—è</div>
          </div>
        </div>

        <!-- Analytics -->
        <div id="analyticsSection" class="panel" style="display:none;margin-top:14px">
          <div class="card">
            <h3 style="margin:0 0 8px 0">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á—ë—Ç—ã</h3>
            <div style="display:flex;gap:12px;flex-wrap:wrap">
              <div style="min-width:160px"><div class="small muted">–í—Å–µ–≥–æ –≤–µ—â–µ–π</div><div class="kpi" id="anTotal">‚Äî</div></div>
              <div style="min-width:160px"><div class="small muted">–ï—Å—Ç—å</div><div class="kpi" id="anOwned">‚Äî</div></div>
              <div style="min-width:160px"><div class="small muted">–ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å</div><div class="kpi" id="anNeeded">‚Äî</div></div>
              <div style="min-width:160px"><div class="small muted">–ö—Ä–∏—Ç–∏—á–Ω—ã—Ö</div><div class="kpi" id="anCritical">‚Äî</div></div>
            </div>
          </div>

          <div style="margin-top:12px" class="card">
            <h4>–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π / —Å–æ–±—ã—Ç–∏—è</h4>
            <div id="eventsLog" style="max-height:220px;overflow:auto;padding-top:8px"></div>
          </div>

          <div style="margin-top:12px" class="card">
            <h4>–ü–æ–∫—É–ø–∫–∏ –ø–æ –º–µ—Å—è—Ü–∞–º</h4>
            <div id="purchasesByMonth" style="margin-top:8px"></div>
          </div>

          <div style="margin-top:12px" class="card">
            <h4>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h4>
            <div id="recommendations" style="margin-top:8px"></div>
          </div>
        </div>

        <!-- Settings -->
        <div id="settingsSection" class="panel" style="display:none;margin-top:14px">
          <div class="card">
            <h3 style="margin:0 0 8px 0">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ & –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</h3>
            <p class="small muted">–û–ø—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π. –î–ª—è –ø–æ–ª–Ω–æ–π —Ä–∞–±–æ—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –∫—Ä–æ—Å—Å‚Äë—É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é Supabase + GitHub Actions + Telegram (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –±—É–¥—É—Ç –≤ PR).</p>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
              <div>
                <label class="small muted">–í–∫–ª—é—á–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label><br/>
                <button id="enableNotifBtn" class="btn ghost" style="margin-top:6px">–†–∞–∑—Ä–µ—à–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
              </div>
              <div>
                <label class="small muted">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Telegram (—Ç—Ä–µ–±—É–µ—Ç backend)</label><br/>
                <button id="telegramSetupBtn" class="btn ghost" style="margin-top:6px">–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Sidebar -->
      <aside class="sidebar panel" id="sidebar">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <div>
            <div class="small muted">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <div class="kpi" id="statTotal">‚Äî</div>
          </div>
          <div style="text-align:right">
            <div class="small muted">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å</div>
            <div class="kpi" id="statCompletion">‚Äî</div>
          </div>
        </div>

        <div style="margin-top:10px" class="card">
          <div class="small muted">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–∫–æ—Ä–æ—Ç–∫–∏–µ)</div>
          <div id="sidebarRecs" style="margin-top:8px"></div>
        </div>

        <div style="margin-top:10px" class="card">
          <div class="small muted">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–≥–∏</div>
          <div id="topTags" style="margin-top:8px"></div>
        </div>

        <div style="margin-top:10px" class="card">
          <div class="small muted">–ë—é–¥–∂–µ—Ç (–∞–∫—Ç—É–∞–ª—å–Ω—ã–π –º–µ—Å—èÔøΩÔøΩ)</div>
          <div id="monthBudget" style="margin-top:8px"></div>
        </div>
      </aside>
    </main>
  </div>

  <!-- modal container -->
  <div id="modalRoot"></div>

<script>
/*
  –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π single-file —à–∞–±–ª–æ–Ω –¥–ª—è GitHub Pages.
  –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç-—Å–∞–π–¥–æ–≤–æ:
  - —Ñ–æ—Ç–æ (base64) –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage)
  - –¥–≤–∞ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞: —Å–ø–∏—Å–æ–∫/—Å–µ—Ç–∫–∞
  - –∏—Å—Ç–æ—Ä–∏—è —Å–æ–±—ã—Ç–∏–π (analytics log) –≤ localStorage
  - timestamps: addedAt, purchasedAt, updatedAt
  - purchase history by month
  - recommendations (rule-based)
  - reminders (–ª–æ–∫–∞–ª—å–Ω—ã–µ): —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏; –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è Browser Notifications –µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
  - outfits generator (–ø—Ä–æ—Å—Ç–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º) + weekly planner
  - capsule helper: —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞ –∏ –ø–æ–¥—Å—á—ë—Ç –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫–∏ (–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å/—ç–∫—Å–ø–æ—Ä—Ç)
  - export/import JSON
  - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ keys:
      wardrobe-data-v2
      shopping-data-v2
      outfits-data-v2
      links-data-v2
      analytics-data-v1
      reminders-data-v1
*/

const KEYS = {
  wardrobe: 'wardrobe-data-v2',
  shopping: 'shopping-data-v2',
  outfits: 'outfits-data-v2',
  links: 'links-data-v2',
  analytics: 'analytics-data-v1',
  reminders: 'reminders-data-v1'
};

function safeParse(s){ try{ return JSON.parse(s); }catch(e){ return null; } }
function storageGet(k){ try{ const r = localStorage.getItem(k); return r ? safeParse(r) : null; }catch(e){ console.warn('storageGet',e); return null; } }
function storageSet(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch(e){ console.warn('storageSet',e); } }
function uid(){ return Date.now() + Math.floor(Math.random()*1000); }
function nowISO(){ return new Date().toISOString(); }
function daysBetween(d1,d2){ return Math.round((new Date(d2)-new Date(d1)) / (1000*60*60*24)); }

/* init data if missing */
function initIfEmpty(){
  if(!storageGet(KEYS.wardrobe)){
    const sample = {
      suits:[{ id:1, name:'–ö–æ—Å—Ç—é–º —á–µ—Ä–Ω—ã–π –æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π', status:'–µ—Å—Ç—å', priority:'–≤—ã—Å–æ–∫–∏–π', tags:'–æ—Ñ–∏—Å,—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π', notes:'', photo:'', addedAt: nowISO(), updatedAt: nowISO(), usageCount:3, wearHistory:[] }],
      shirts:[{ id:2, name:'–†—É–±–∞—à–∫–∞ –±–µ–ª–∞—è', status:'–µ—Å—Ç—å', priority:'–Ω–∏–∑–∫–∏–π', tags:'–±–∞–∑–æ–≤—ã–π', notes:'', photo:'', addedAt: nowISO(), updatedAt: nowISO(), usageCount:7, wearHistory:[] }],
      knitwear:[], polo:[], pants:[], shoes:[], accessories:[]
    };
    storageSet(KEYS.wardrobe, sample);
  }
  if(!storageGet(KEYS.shopping)) storageSet(KEYS.shopping, []);
  if(!storageGet(KEYS.outfits)) storageSet(KEYS.outfits, []);
  if(!storageGet(KEYS.links)) storageSet(KEYS.links, []);
  if(!storageGet(KEYS.analytics)) storageSet(KEYS.analytics, []);
  if(!storageGet(KEYS.reminders)) storageSet(KEYS.reminders, []);
}
initIfEmpty();

let wardrobe = storageGet(KEYS.wardrobe) || {};
let shopping = storageGet(KEYS.shopping) || [];
let outfits = storageGet(KEYS.outfits) || [];
let analytics = storageGet(KEYS.analytics) || [];
let reminders = storageGet(KEYS.reminders) || [];

/* ---- Utilities ---- */
function escapeHtml(s){ if(!s) return ''; return s.replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
function flatten(w){ return Object.entries(w).flatMap(([cat,arr]) => (arr||[]).map(it => ({...it, category:cat}))); }
function pushEvent(type, payload={}){ analytics = storageGet(KEYS.analytics) || []; analytics.unshift({ id:uid(), type, payload, ts: nowISO() }); storageSet(KEYS.analytics, analytics); renderEvents(); }

/* ---- Photo handling: file -> dataURL ---- */
function fileToDataURL(file){ return new Promise(resolve => { const r=new FileReader(); r.onload = ()=>resolve(r.result); r.readAsDataURL(file); }); }

/* ---- Add item ---- */
document.getElementById('addItemBtn').addEventListener('click', async ()=>{
  const name = (document.getElementById('newName').value||'').trim(); if(!name){ alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'); return; }
  const category = document.getElementById('newCategory').value;
  const status = document.getElementById('newStatus').value;
  const priority = document.getElementById('newPriority').value;
  const tags = (document.getElementById('newTags').value||'').trim();
  const notes = (document.getElementById('newNotes').value||'').trim();
  const fileInput = document.getElementById('newPhoto');
  let photo = '';
  if(fileInput.files && fileInput.files[0]) photo = await fileToDataURL(fileInput.files[0]);
  const item = { id: uid(), name, status, priority, tags, notes, photo, addedAt: nowISO(), updatedAt: nowISO(), usageCount:0, wearHistory: [] };
  wardrobe[category] = wardrobe[category] || [];
  wardrobe[category].push(item);
  storageSet(KEYS.wardrobe, wardrobe);
  pushEvent('add_item', { id:item.id, name:item.name, category });
  clearAddForm();
  renderAll();
});
function clearAddForm(){ document.getElementById('newName').value=''; document.getElementById('newTags').value=''; document.getElementById('newNotes').value=''; document.getElementById('newPhoto').value=''; }

/* ---- Render items (list & grid) ---- */
let viewMode = 'list';
const listViewBtn = document.getElementById('listViewBtn');
const gridViewBtn = document.getElementById('gridViewBtn');
listViewBtn.addEventListener('click', ()=> setView('list'));
gridViewBtn.addEventListener('click', ()=> setView('grid'));
function setView(mode){
  viewMode = mode;
  document.getElementById('listView').style.display = mode==='list' ? '' : 'none';
  document.getElementById('gridView').style.display = mode==='grid' ? '' : 'none';
  listViewBtn.classList.toggle('active', mode==='list');
  gridViewBtn.classList.toggle('active', mode==='grid');
  renderItems();
}

function renderItems(){
  wardrobe = storageGet(KEYS.wardrobe) || wardrobe;
  const items = flatten(wardrobe);
  const q = (document.getElementById('search').value||'').toLowerCase();
  const statusFilter = document.getElementById('filterStatus').value;
  const prFilter = document.getElementById('filterPriority').value;
  let shown = items.slice();
  if(q) shown = shown.filter(i => i.name.toLowerCase().includes(q) || (i.tags||'').toLowerCase().includes(q));
  if(statusFilter !== 'all') shown = shown.filter(i => i.status === statusFilter);
  if(prFilter !== 'all') shown = shown.filter(i => i.priority === prFilter);

  // LIST
  const list = document.getElementById('itemsList'); list.innerHTML = '';
  // GRID
  const grid = document.getElementById('itemsGrid'); grid.innerHTML = '';

  if(shown.length === 0){
    list.innerHTML = '<div class="muted">–ù–µ—Ç –≤–µ—â–µ–π</div>';
    grid.innerHTML = '<div class="muted">–ù–µ—Ç –≤–µ—â–µ–π</div>';
    return;
  }

  shown.forEach(it=>{
    // list item
    const li = document.createElement('div'); li.className = 'item';
    const photoDiv = document.createElement('div'); photoDiv.className='item-photo';
    if(it.photo){ const img = document.createElement('img'); img.src = it.photo; img.alt=''; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover'; img.style.borderRadius='8px'; photoDiv.appendChild(img); } else { photoDiv.textContent = 'üñº'; }
    const info = document.createElement('div'); info.style.flex = '1';
    const title = document.createElement('div'); title.innerHTML = `<strong>${escapeHtml(it.name)}</strong> <span class="muted">(${escapeHtml(it.category)})</span>`;
    const meta = document.createElement('div'); meta.style.marginTop='6px';
    const statusBadge = `<span class="badge ${it.status==='–µ—Å—Ç—å'?'green':'red'}">${it.status==='–µ—Å—Ç—å'?'–ï—Å—Ç—å':'–ù—É–∂–Ω–æ'}</span>`;
    const prCol = it.priority==='–∫—Ä–∏—Ç–∏—á–Ω—ã–π' ? '#7f1d1d' : it.priority==='–≤—ã—Å–æ–∫–∏–π' ? '#9a3412' : it.priority==='—Å—Ä–µ–¥–Ω–∏–π' ? '#713f12' : '#374151';
    const prBadge = `<span class="badge" style="background:${prCol};color:#fff;margin-left:8px">${escapeHtml(it.priority)}</span>`;
    meta.innerHTML = statusBadge + prBadge;
    const tags = document.createElement('div'); tags.className='small muted'; tags.style.marginTop='8px'; tags.textContent = it.tags? '#'+it.tags.split(',')[0] : '';
    const actions = document.createElement('div'); actions.style.marginTop='10px'; actions.style.display='flex'; actions.style.gap='8px';
    const editBtn = document.createElement('button'); editBtn.className='btn ghost'; editBtn.textContent='–ò–∑–º–µ–Ω–∏—Ç—å'; editBtn.onclick = ()=> openEditModal(it.id);
    const delBtn = document.createElement('button'); delBtn.className='btn ghost'; delBtn.textContent='–£–¥–∞–ª–∏—Ç—å'; delBtn.onclick = ()=> { if(confirm('–£–¥–∞–ª–∏—Ç—å?')) { deleteItem(it.id); } };
    const wearBtn = document.createElement('button'); wearBtn.className='btn ghost'; wearBtn.textContent='–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–∞–¥–µ—Ç–æ–µ'; wearBtn.onclick = ()=> markWorn(it.id);
    actions.appendChild(editBtn); actions.appendChild(wearBtn); actions.appendChild(delBtn);
    info.appendChild(title); info.appendChild(meta); info.appendChild(tags); info.appendChild(actions);
    li.appendChild(photoDiv); li.appendChild(info);
    list.appendChild(li);

    // grid card
    const card = document.createElement('div'); card.className='grid-card';
    const p = document.createElement('div'); p.className='card-photo';
    if(it.photo){ const img = document.createElement('img'); img.src = it.photo; img.alt=''; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover'; p.appendChild(img); } else { p.textContent='üñº'; }
    const body = document.createElement('div'); body.className='card-body';
    body.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${escapeHtml(it.name)}</strong><div class="small muted">${escapeHtml(it.category)}</div></div><div>${it.status==='–µ—Å—Ç—å'?'<span class="badge green">–ï—Å—Ç—å</span>':'<span class="badge red">–ù—É–∂–Ω–æ</span>'}</div></div>`;
    const cactions = document.createElement('div'); cactions.style.marginTop='10px'; cactions.style.display='flex'; cactions.style.gap='8px';
    const e2 = document.createElement('button'); e2.className='btn ghost'; e2.textContent='–ò–∑–º–µ–Ω–∏—Ç—å'; e2.onclick = ()=> openEditModal(it.id);
    const d2 = document.createElement('button'); d2.className='btn ghost'; d2.textContent='–£–¥–∞–ª–∏—Ç—å'; d2.onclick = ()=> { if(confirm('–£–¥–∞–ª–∏—Ç—å?')) deleteItem(it.id); };
    cactions.appendChild(e2); cactions.appendChild(d2);
    body.appendChild(cactions);
    card.appendChild(p); card.appendChild(body);
    grid.appendChild(card);
  });
}

/* ---- Delete item ---- */
function deleteItem(id){
  Object.keys(wardrobe).forEach(cat=>{
    wardrobe[cat] = (wardrobe[cat]||[]).filter(i=>i.id!==id);
  });
  storageSet(KEYS.wardrobe, wardrobe);
  pushEvent('delete_item', { id }); renderAll();
}

/* ---- Mark worn (wear history) ---- */
function markWorn(id){
  let found=null; let catKey=null;
  for(const [cat,arr] of Object.entries(wardrobe)){
    const f = (arr||[]).find(i=>i.id===id);
    if(f){ found=f; catKey=cat; break; }
  }
  if(!found) return alert('–ù–µ –Ω–∞–π–¥–µ–Ω–æ');
  const note = prompt('–ó–∞–ø–∏—Å–∞—Ç—å –∑–∞–º–µ—Ç–∫—É –¥–ª—è —Å–æ–±—ã—Ç–∏—è –Ω–æ—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)');
  const date = new Date().toISOString();
  found.wearHistory = found.wearHistory || [];
  found.wearHistory.push({ date, note: note||'' });
  found.usageCount = (found.usageCount||0) + 1;
  found.lastWorn = date;
  found.updatedAt = nowISO();
  storageSet(KEYS.wardrobe, wardrobe);
  pushEvent('mark_worn', { id, date, note });
  renderAll();
}

/* ---- Edit modal (with photo replace/delete) ---- */
function openEditModal(id){
  let item=null, catKey=null;
  for(const [cat,arr] of Object.entries(wardrobe)){
    const f = (arr||[]).find(i=>i.id===id);
    if(f){ item=f; catKey=cat; break; }
  }
  if(!item) return alert('–ù–µ –Ω–∞–π–¥–µ–Ω–æ');
  const modalRoot = document.getElementById('modalRoot'); modalRoot.innerHTML = '';
  const back = document.createElement('div'); back.className='modal-backdrop';
  const modal = document.createElement('div'); modal.className='modal';
  modal.innerHTML = `<h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—â—å</h3>
  <div style="display:grid;grid-template-columns:1fr 160px;gap:8px;margin-top:8px">
    <input id="editName" type="text" value="${escapeHtml(item.name)}" />
    <select id="editCategory"><option value="suits">–ö–æ—Å—Ç—é–º—ã</option><option value="shirts">–†—É–±–∞—à–∫–∏</option><option value="knitwear">–¢—Ä–∏–∫–æ—Ç–∞–∂</option><option value="polo">–ü–æ–ª–æ</option><option value="pants">–ë—Ä—é–∫–∏</option><option value="shoes">–û–±—É–≤—å</option><option value="accessories">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</option></select>
    <select id="editStatus"><option value="–µ—Å—Ç—å">–ï—Å—Ç—å</option><option value="–Ω—É–∂–µ–Ω">–ù—É–∂–µ–Ω</option></select>
    <select id="editPriority"><option value="–Ω–∏–∑–∫–∏–π">–ù–∏–∑–∫–∏–π</option><option value="—Å—Ä–µ–¥–Ω–∏–π">–°—Ä–µ–¥–Ω–∏–π</option><option value="–≤—ã—Å–æ–∫–∏–π">–í—ã—Å–æ–∫–∏–π</option><option value="–∫—Ä–∏—Ç–∏—á–Ω—ã–π">–ö—Ä–∏—Ç–∏—á–Ω—ã–π</option></select>
    <input id="editTags" type="text" value="${escapeHtml(item.tags||'')}" style="grid-column:1/span2" />
    <textarea id="editNotes" style="grid-column:1/span2">${escapeHtml(item.notes||'')}</textarea>
    <div style="display:flex;align-items:center;gap:8px">
      <input id="editPhotoInput" type="file" accept="image/*" />
    </div>
    <div style="display:flex;justify-content:flex-end">
      <button id="saveEditBtn" class="btn primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
  <div style="margin-top:12px" id="currentPhotoArea"></div>`;
  back.appendChild(modal);
  modalRoot.appendChild(back);

  document.getElementById('editCategory').value = catKey;
  document.getElementById('editStatus').value = item.status || '–µ—Å—Ç—å';
  document.getElementById('editPriority').value = item.priority || '–Ω–∏–∑–∫–∏–π';

  const cur = document.getElementById('currentPhotoArea');
  cur.innerHTML = '';
  if(item.photo){
    const p = document.createElement('div'); p.className='photo-preview';
    const img = document.createElement('img'); img.src = item.photo;
    const d = document.createElement('button'); d.className='del-photo'; d.textContent='‚úï'; d.title='–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ';
    d.onclick = ()=> { if(confirm('–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ?')){ item.photo=''; storageSet(KEYS.wardrobe, wardrobe); cur.innerHTML = '<div class="muted">–§–æ—Ç–æ —É–¥–∞–ª–µ–Ω–æ</div>'; } };
    p.appendChild(img); p.appendChild(d); cur.appendChild(p);
  } else { cur.innerHTML = '<div class="muted">–§–æ—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</div>'; }

  document.getElementById('saveEditBtn').onclick = async ()=>{
    const newName = (document.getElementById('editName').value||'').trim(); if(!newName) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
    const newCat = document.getElementById('editCategory').value;
    const newStatus = document.getElementById('editStatus').value;
    const newPriority = document.getElementById('editPriority').value;
    const newTags = (document.getElementById('editTags').value||'').trim();
    const newNotes = (document.getElementById('editNotes').value||'').trim();
    const photoInput = document.getElementById('editPhotoInput');
    if(photoInput.files && photoInput.files[0]){ item.photo = await fileToDataURL(photoInput.files[0]); }
    // move category if changed
    if(newCat !== catKey){
      wardrobe[catKey] = (wardrobe[catKey]||[]).filter(i=>i.id!==item.id);
      item.name = newName; item.status=newStatus; item.priority=newPriority; item.tags=newTags; item.notes=newNotes; item.updatedAt = nowISO();
      wardrobe[newCat] = wardrobe[newCat] || [];
      wardrobe[newCat].push(item);
    } else {
      Object.assign(item, { name:newName, status:newStatus, priority:newPriority, tags:newTags, notes:newNotes, updatedAt: nowISO() });
    }
    storageSet(KEYS.wardrobe, wardrobe);
    pushEvent('update_item', { id:item.id, name:item.name });
    closeModal(); renderAll();
  };

  back.addEventListener('click', (e)=>{ if(e.target===back) closeModal(); });
}
function closeModal(){ document.getElementById('modalRoot').innerHTML = ''; }

/* ---- Shopping: add/toggle/purchasedAt and reminders ---- */
document.getElementById('addShopBtn').addEventListener('click', ()=>{
  const name = (document.getElementById('shopName').value||'').trim(); if(!name) return alert('–í–≤–µ–¥–∏—Ç–µ —á—Ç–æ –∫—É–ø–∏—Ç—å');
  const priority = document.getElementById('shopPriority').value; const price = (document.getElementById('shopPrice').value||'').trim();
  const planned = document.getElementById('shopPlannedDate').value || '';
  shopping = storageGet(KEYS.shopping) || [];
  const obj = { id: uid(), item: name, priority, price, plannedDate: planned, purchased:false, purchasedAt:'', createdAt: nowISO() };
  shopping.push(obj);
  storageSet(KEYS.shopping, shopping);
  pushEvent('add_shopping', { id: obj.id, item: obj.item });
  document.getElementById('shopName').value=''; document.getElementById('shopPrice').value=''; document.getElementById('shopPlannedDate').value='';
  renderShopping();
});
function renderShopping(){
  shopping = storageGet(KEYS.shopping) || [];
  const active = shopping.filter(s=>!s.purchased);
  const comp = shopping.filter(s=>s.purchased);
  const actCont = document.getElementById('activePurchases'); actCont.innerHTML = '';
  active.forEach(s=>{
    const d = document.createElement('div'); d.className='item';
    d.innerHTML = `<div style="flex:1"><strong>${escapeHtml(s.item)}</strong> <div class="small muted">${escapeHtml(s.priority)} ${s.price? '‚Äî '+escapeHtml(s.price):''} ${s.plannedDate? ' ‚Ä¢ –ø–ª–∞–Ω: '+escapeHtml(s.plannedDate):''}</div></div>`;
    const b1=document.createElement('button'); b1.className='btn ghost'; b1.textContent='–û—Ç–º–µ—Ç–∏—Ç—å –∫—É–ø–ª–µ–Ω–æ'; b1.onclick=()=> markPurchased(s.id);
    const b2=document.createElement('button'); b2.className='btn ghost'; b2.textContent='–£–¥–∞–ª–∏—Ç—å'; b2.onclick=()=>{ if(confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–∫—É–ø–∫—É?')) removeShopping(s.id); };
    const actions=document.createElement('div'); actions.style.display='flex'; actions.style.gap='8px'; actions.appendChild(b1); actions.appendChild(b2); d.appendChild(actions);
    actCont.appendChild(d);
  });
  const compCont = document.getElementById('completedPurchases'); compCont.innerHTML = '';
  comp.forEach(s=>{
    const d = document.createElement('div'); d.className='item';
    d.innerHTML = `<div style="flex:1"><strong style="text-decoration:line-through">${escapeHtml(s.item)}</strong> <div class="small muted">${s.purchasedAt || ''}</div></div>`;
    const del=document.createElement('button'); del.className='btn ghost'; del.textContent='–£–¥–∞–ª–∏—Ç—å'; del.onclick=()=> removeShopping(s.id);
    d.appendChild(del); compCont.appendChild(d);
  });
}
function markPurchased(id){
  shopping = storageGet(KEYS.shopping) || [];
  shopping = shopping.map(s => s.id===id ? {...s, purchased:true, purchasedAt: nowISO()} : s);
  storageSet(KEYS.shopping, shopping);
  pushEvent('purchased', { id });
  renderShopping(); renderAnalytics();
}
function removeShopping(id){ shopping = storageGet(KEYS.shopping) || []; shopping = shopping.filter(s=>s.id!==id); storageSet(KEYS.shopping, shopping); renderShopping(); }

/* ---- Outfits generator & planner ---- */
document.getElementById('generateBtn').addEventListener('click', ()=> generateOutfits());
document.getElementById('addOutfitBtn').addEventListener('click', ()=>{
  const name = (document.getElementById('outfitName').value||'').trim(); if(!name) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –æ–±—Ä–∞–∑–∞');
  const itemsRaw = (document.getElementById('outfitItems').value||'').split(',').map(s=>s.trim()).filter(Boolean);
  const season = document.getElementById('outfitSeason').value || '';
  outfits = storageGet(KEYS.outfits) || []; outfits.push({ id:uid(), name, items: itemsRaw, season, createdAt: nowISO() }); storageSet(KEYS.outfits, outfits); document.getElementById('outfitName').value=''; document.getElementById('outfitItems').value=''; renderOutfits();
});
function generateOutfits(){
  const occasion = document.getElementById('generatorOccasion').value || '';
  const all = flatten(storageGet(KEYS.wardrobe)||wardrobe).filter(i=>i.status==='–µ—Å—Ç—å');
  // simple heuristics: build combinations of [suits|shirts] + pants + shoes etc.
  const suits = all.filter(i=>i.category==='suits');
  const shirts = all.filter(i=>i.category==='shirts');
  const pants = all.filter(i=>i.category==='pants');
  const shoes = all.filter(i=>i.category==='shoes');
  const suggestions = [];
  // generate suit outfits
  suits.forEach(s=>{ shirts.forEach(sh=>{ shoes.forEach(sho=>{ suggestions.push({ items:[s,sh,sho], score: (s.usageCount||0)+(sh.usageCount||0)+(sho.usageCount||0) }); }); }); });
  // business casual: shirt + pants + shoes
  shirts.forEach(sh=>{ pants.forEach(p=>{ shoes.forEach(sho=>{ suggestions.push({ items:[sh,p,sho], score:(sh.usageCount||0)+(p.usageCount||0)+(sho.usageCount||0) }); }); }); });
  // sort by score descending (more used items first)
  suggestions.sort((a,b)=>b.score - a.score);
  const container = document.getElementById('generatedOutfits'); container.innerHTML = '';
  suggestions.slice(0,8).forEach((sug, idx)=>{
    const div = document.createElement('div'); div.className='card'; div.style.marginBottom='8px';
    const names = sug.items.map(x=>x.name).join(' ‚Ä¢ ');
    div.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ ${idx+1}</strong><div class="small muted">${escapeHtml(names)}</div></div><div><button class="btn ghost">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –æ–±—Ä–∞–∑</button></div></div>`;
    const btn = div.querySelector('button'); btn.onclick = ()=> { outfits = storageGet(KEYS.outfits)||[]; outfits.push({ id:uid(), name: '–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ ' + (idx+1), items: sug.items.map(i=>i.name), season:'', createdAt: nowISO() }); storageSet(KEYS.outfits, outfits); renderOutfits(); alert('–û–±—Ä–∞–∑ –¥–æ–±–∞–≤–ª–µ–Ω'); };
    container.appendChild(div);
  });
}
function renderOutfits(){
  outfits = storageGet(KEYS.outfits) || [];
  const cont = document.getElementById('outfitsList'); cont.innerHTML = '';
  if(outfits.length===0){ cont.innerHTML = '<div class="muted">–ù–µ—Ç –æ–±—Ä–∞–∑–æ–≤</div>'; return; }
  outfits.forEach(o=>{
    const div = document.createElement('div'); div.className='card'; div.style.marginBottom='8px';
    div.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>${escapeHtml(o.name)}</strong> <div class="small muted">${escapeHtml(o.season||'')}</div></div><div><button class="btn ghost small">–£–¥–∞–ª–∏—Ç—å</button></div></div><div style="margin-top:8px" class="small muted">${escapeHtml((o.items||[]).join(', '))}</div>`;
    div.querySelector('button').onclick = ()=> { if(confirm('–£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑?')){ outfits = outfits.filter(x=>x.id!==o.id); storageSet(KEYS.outfits, outfits); renderOutfits(); } };
    cont.appendChild(div);
  });
}

/* Weekly planner: simple mapping day->outfitId */
const WEEK_DAYS = ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'];
function renderWeekPlanner(){
  const planner = JSON.parse(localStorage.getItem('wardrobe-planner') || '{}');
  const container = document.getElementById('weekPlanner'); container.innerHTML = '';
  outfits = storageGet(KEYS.outfits) || [];
  for(let i=0;i<7;i++){
    const cell = document.createElement('div'); cell.className='card'; cell.style.padding='8px';
    const day = WEEK_DAYS[i];
    const sel = document.createElement('select'); sel.style.width='100%';
    const opt0 = document.createElement('option'); opt0.value=''; opt0.textContent='‚Äî –ø—É—Å—Ç–æ ‚Äî'; sel.appendChild(opt0);
    outfits.forEach(o=>{ const op = document.createElement('option'); op.value=o.id; op.textContent=o.name; if(planner[i]==o.id) op.selected=true; sel.appendChild(op); });
    sel.onchange = ()=>{ const p = JSON.parse(localStorage.getItem('wardrobe-planner')||'{}'); p[i]=sel.value; localStorage.setItem('wardrobe-planner', JSON.stringify(p)); alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ'); };
    const title = document.createElement('div'); title.innerHTML = `<strong>${day}</strong>`; title.className='small muted';
    cell.appendChild(title); cell.appendChild(sel);
    container.appendChild(cell);
  }
}

/* ---- Recommendations ---- */
function computeRecommendations(){
  wardrobe = storageGet(KEYS.wardrobe) || wardrobe;
  const items = flatten(wardrobe);
  const recs = [];
  // basics check
  const basicCats = ['suits','shirts','pants','shoes'];
  basicCats.forEach(cat=>{
    const cnt = (wardrobe[cat]||[]).filter(i=>i.status==='–µ—Å—Ç—å').length;
    if(cnt === 0) recs.push({ type:'missing_basic', text:`–£ –≤–∞—Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –±–∞–∑–æ–≤—ã–µ –≤–µ—â–∏: ${cat}` });
  });
  // update suggestion by age: if median age > 3 years (1095 days)
  const byCat = {};
  Object.entries(wardrobe).forEach(([cat,arr]) => { byCat[cat] = arr||[]; });
  Object.entries(byCat).forEach(([cat,arr])=>{
    if(!arr || arr.length===0) return;
    const ages = arr.map(it => daysBetween(it.addedAt || it.updatedAt || nowISO(), nowISO()));
    const median = ages.sort((a,b)=>a-b)[Math.floor(ages.length/2)] || 0;
    if(median > 365*3) recs.push({ type:'old_category', text:`–í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ${cat} –≤–µ—â–∏ –≤ —Å—Ä–µ–¥–Ω–µ–º —Å—Ç–∞—Ä—ã–µ (‚âà ${Math.round(median/365)} –ª–µ—Ç). –ü–æ–¥—É–º–∞–π—Ç–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.` });
  });
  // critical purchases
  const crit = (storageGet(KEYS.shopping)||[]).filter(s=> (s.priority||'').toString().toLowerCase().includes('–∫—Ä–∏—Ç'));
  if(crit.length) recs.push({ type:'criticals', text:`–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏: ${crit.map(c=>c.item).slice(0,5).join(', ')}` });

  // tag frequency analysis
  const tags = {};
  items.forEach(i=> (i.tags||'').split(',').map(t=>t.trim().toLowerCase()).filter(Boolean).forEach(t => tags[t] = (tags[t]||0)+1));
  const sortedTags = Object.entries(tags).sort((a,b)=>b[1]-a[1]);
  if(sortedTags.length){
    recs.push({ type:'tags_top', text: `–¢–æ–ø —Ç–µ–≥–æ–≤: ${sortedTags.slice(0,5).map(t=>t[0]).join(', ')}` });
    const low = sortedTags.filter(t=>t[1]===1).map(t=>t[0]).slice(0,5);
    if(low.length) recs.push({ type:'tags_low', text:`–¢–µ–≥–∏ —Å –Ω–∏–∑–∫–æ–π —á–∞—Å—Ç–æ—Ç–æ–π: ${low.join(', ')}` });
  }
  return recs;
}

/* ---- Analytics UI ---- */
function renderEvents(){
  analytics = storageGet(KEYS.analytics) || [];
  const el = document.getElementById('eventsLog'); el.innerHTML = '';
  analytics.slice(0,200).forEach(ev=>{
    const d = document.createElement('div'); d.className='small muted'; d.style.marginBottom='6px';
    d.textContent = `${new Date(ev.ts).toLocaleString()} ‚Ä¢ ${ev.type} ‚Ä¢ ${JSON.stringify(ev.payload).slice(0,80)}`;
    el.appendChild(d);
  });
}

/* purchases by month */
function renderPurchasesByMonth(){
  shopping = storageGet(KEYS.shopping) || [];
  const bought = shopping.filter(s=>s.purchased && s.purchasedAt);
  const map = {};
  bought.forEach(b=>{
    const d = new Date(b.purchasedAt);
    const key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
    map[key] = map[key]||[]; map[key].push(b);
  });
  const cont = document.getElementById('purchasesByMonth'); cont.innerHTML = '';
  Object.entries(map).sort((a,b)=>b[0].localeCompare(a[0])).forEach(([month,arr])=>{
    const div = document.createElement('div'); div.className='small muted'; div.style.marginBottom='6px';
    div.textContent = `${month}: ${arr.length} –ø–æ–∫—É–ø–æ–∫ ‚Äî ${arr.map(x=>x.item).slice(0,5).join(', ')}`;
    cont.appendChild(div);
  });
}

/* ---- Recommendations UI ---- */
function renderRecommendations(){
  const recs = computeRecommendations();
  const cont = document.getElementById('recommendations'); cont.innerHTML = '';
  const sb = document.getElementById('sidebarRecs'); sb.innerHTML = '';
  recs.forEach(r=>{
    const d = document.createElement('div'); d.className='small muted'; d.style.marginBottom='6px'; d.textContent = '‚Ä¢ ' + r.text;
    cont.appendChild(d);
    const d2 = d.cloneNode(true); sb.appendChild(d2);
  });
}

/* ---- Sidebar tags ---- */
function renderTopTags(){
  const items = flatten(storageGet(KEYS.wardrobe) || wardrobe);
  const map = {};
  items.forEach(i=> (i.tags||'').split(',').map(t=>t.trim().toLowerCase()).filter(Boolean).forEach(t=> map[t]=(map[t]||0)+1));
  const arr = Object.entries(map).sort((a,b)=>b[1]-a[1]).slice(0,12);
  const el = document.getElementById('topTags'); el.innerHTML = '';
  if(arr.length===0){ el.innerHTML = '<div class="muted">–ù–µ—Ç —Ç–µ–≥–æ–≤</div>'; return; }
  arr.forEach(a=>{ const d=document.createElement('div'); d.className='small muted'; d.textContent = `#${a[0]} ‚Äî ${a[1]}`; el.appendChild(d); });
}

/* ---- Analytics totals ---- */
function renderAnalytics(){
  const items = flatten(storageGet(KEYS.wardrobe) || wardrobe);
  const total = items.length;
  const owned = items.filter(i=>i.status==='–µ—Å—Ç—å').length;
  const needed = items.filter(i=>i.status!=='–µ—Å—Ç—å').length;
  const critical = items.filter(i=> (i.priority||'').toString().toLowerCase().includes('–∫—Ä–∏—Ç')).length;
  document.getElementById('anTotal').textContent = total;
  document.getElementById('anOwned').textContent = owned;
  document.getElementById('anNeeded').textContent = needed;
  document.getElementById('anCritical').textContent = critical;

  // sidebar summary
  document.getElementById('statTotal').textContent = `${total} –≤–µ—â–µ–π`;
  const completion = total? Math.round((owned/total)*100):0;
  document.getElementById('statCompletion').textContent = `${completion}%`;
}

/* ---- Export / Import JSON ---- */
document.getElementById('exportJsonBtn').addEventListener('click', ()=>{
  const payload = {
    wardrobe: storageGet(KEYS.wardrobe) || {},
    shopping: storageGet(KEYS.shopping) || [],
    outfits: storageGet(KEYS.outfits) || [],
    links: storageGet(KEYS.links) || [],
    analytics: storageGet(KEYS.analytics) || []
  };
  const blob = new Blob([JSON.stringify(payload, null, 2)], { type:'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download = 'wardrobe-export.json'; a.click(); URL.revokeObjectURL(url);
});
document.getElementById('importJsonBtn').addEventListener('click', ()=>{
  const input = document.createElement('input'); input.type='file'; input.accept='application/json';
  input.onchange = async ()=> {
    const f = input.files[0]; if(!f) return;
    const txt = await f.text(); try{ const data = JSON.parse(txt); if(data.wardrobe) storageSet(KEYS.wardrobe, data.wardrobe); if(data.shopping) storageSet(KEYS.shopping, data.shopping); if(data.outfits) storageSet(KEYS.outfits, data.outfits); if(data.links) storageSet(KEYS.links, data.links); if(data.analytics) storageSet(KEYS.analytics, data.analytics); alert('–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω'); renderAll(); } catch(e){ alert('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON'); }
  };
  input.click();
});

/* ---- Events / render orchestration ---- */
function renderAll(){
  wardrobe = storageGet(KEYS.wardrobe) || wardrobe;
  shopping = storageGet(KEYS.shopping) || shopping;
  outfits = storageGet(KEYS.outfits) || outfits;
  analytics = storageGet(KEYS.analytics) || analytics;
  reminders = storageGet(KEYS.reminders) || reminders;
  renderItems();
  renderShopping();
  renderOutfits();
  renderOutfits(); // twice for safety
  renderEvents();
  renderPurchasesByMonth();
  renderRecommendations();
  renderTopTags();
  renderAnalytics();
  renderWeekPlanner();
  renderMonthBudget();
}
renderAll();

/* ---- Reminders: local check and browser notifications ---- */
document.getElementById('enableNotifBtn').addEventListener('click', async ()=>{
  if(!('Notification' in window)){ alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è'); return; }
  const res = await Notification.requestPermission();
  if(res === 'granted') alert('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã'); else alert('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã');
});

/* reminders storage, add simple reminder for shopping item */
function addReminderForShopping(shoppingId, whenISO){
  reminders = storageGet(KEYS.reminders) || [];
  reminders.push({ id: uid(), type:'shopping', targetId: shoppingId, when: whenISO, sent:false });
  storageSet(KEYS.reminders, reminders);
  pushEvent('add_reminder', { id: shoppingId, when: whenISO });
}

/* scheduled check every minute for due reminders (works while page is open) */
setInterval(checkReminders, 60*1000);
function checkReminders(){
  reminders = storageGet(KEYS.reminders) || [];
  const now = new Date();
  reminders.forEach(r=>{
    if(!r.sent && new Date(r.when) <= now){
      // show notification
      showNotification(`–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ`, r.type === 'shopping' ? `–ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–æ–∫—É–ø–∫—É: ${getShoppingTitle(r.targetId)}` : '–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ');
      r.sent = true;
      pushEvent('reminder_sent', { id: r.id });
    }
  });
  storageSet(KEYS.reminders, reminders);
}
function showNotification(title, body){
  if('Notification' in window && Notification.permission === 'granted'){
    try{ new Notification(title, { body }); } catch(e){ alert(`${title}\n\n${body}`); }
  } else {
    alert(`${title}\n\n${body}`);
  }
}
function getShoppingTitle(id){ const s = (storageGet(KEYS.shopping)||[]).find(x=>x.id===id); return s? s.item : '–ø–æ–∫—É–ø–∫–∞'; }

/* ---- Analytics rendering helpers ---- */
function renderMonthBudget(){
  shopping = storageGet(KEYS.shopping) || [];
  const monthKey = (()=>{ const d=new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`; })();
  const bought = shopping.filter(s=>s.purchased && s.purchasedAt && s.purchasedAt.startsWith(monthKey));
  const total = bought.reduce((sum,s)=>{ const p = parseFloat((s.price||'').replace(/[^\d.,]/g,'').replace(',','.')); return sum + (isNaN(p)?0:p); }, 0);
  const el = document.getElementById('monthBudget'); el.innerHTML = `<div class="small muted">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ –≤ ${monthKey}: <strong>${total ? total.toFixed(2) : '0'}</strong></div>`;
}

/* ---- Tabs switching ---- */
const tabs = document.querySelectorAll('.tab');
function showTab(name){
  ['wardrobe','shopping','outfits','analytics','settings'].forEach(id=>{
    const el = document.getElementById(id + 'Section');
    if(el) el.style.display = (id === name) ? 'block' : 'none';
  });
  tabs.forEach(t=> t.classList.toggle('active', t.dataset.tab === name));
  // re-render specific if needed
  if(name==='analytics'){ renderAll(); }
}
tabs.forEach(t=> t.addEventListener('click', ()=> showTab(t.dataset.tab)));

/* ---- Helper render calls for UI initial bindings ---- */
document.getElementById('search').addEventListener('input', renderItems);
document.getElementById('filterStatus').addEventListener('change', renderItems);
document.getElementById('filterPriority').addEventListener('change', renderItems);

/* expose some globals for debugging/testing in console */
window._WARDROBE = wardrobe;
window._SHOPPING = shopping;
window._OUTFITS = outfits;
window.pushEvent = pushEvent;

/* initial small cron: check reminders on load */
checkReminders();

/* Accessibility: escape key closes modal */
window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape'){ closeModal(); } });

</script>
</body>
</html>
